# plex-collection-importer
使用 plex-collection-importer 可以将豆瓣、IMDb 和 Trakt 上的片单或其他本地片单导入您的 Plex 媒体库。脚本会通过网络片单或本地片单获取影片数据，然后与选定的库中的影片进行匹配，并将匹配成功的影片添加至与片单同名的合集中，从而实现导入片单的功能。

## 运行条件
- 安装了 Python 3.6 或更高版本。
- 安装了必要的第三方库：plexapi。
- 有可用的 TMDB API。（TMDB API 可在 TMDB 账号设置中免费申请，此项为可选项）

## 配置文件
在运行脚本前，请先打开配置文件 `config.ini`，填写您的 Plex 服务器地址（`address`）和 [X-Plex-Token](https://support.plex.tv/articles/204059436-finding-an-authentication-token-x-plex-token/)（`token`）。若您需要在获取片单时为影片增加 TMDB ID 信息（当使用片名与年份无法匹配影片时，若存在 TMDB ID，脚本会使用 TMDB ID 进行二次匹配，以此解决片单语言与库语言不一致或译名不同产生的匹配问题），请填写您的 TMDB API 密钥（`tmdb_api_key`）；若不需要增加 TMDB ID 信息，将 `tmdb_api_key` 留空即可。
```
[server]
address = http://127.0.0.1:32400
token = 
tmdb_api_key = 
```

## 导入网络片单
当 `collections` 文件夹为空文件夹时，脚本会自动启用**导入网络片单模式**，请运行 `plex-collection-importer.py` 脚本，根据提示进行操作，示例如下：
```
以下是您的Plex服务器上的所有影视库：

1. 电影
2. 动漫
3. 电视剧
4. 综艺

请输入您想选择的库的编号（多个编号请用空格隔开）：1

请输入片单的ID：39639105
请输入片单的类型（movie或tv）：movie

正在获取片单：小成本大创意

1 定时拍摄 (2014) {tmdb-273271}
2 爱的就是你 (2014) {tmdb-242090}
3 双重人格 (2013) {tmdb-146015}
4 追随 (1998) {tmdb-11660}
5 彗星来的那一夜 (2013) {tmdb-220289}
6 初始者 (2004) {tmdb-14337}
7 狗镇 (2003) {tmdb-553}
8 记忆碎片 (2000) {tmdb-77}
9 K星异客 (2001) {tmdb-167}
10 机械姬 (2014) {tmdb-264660}
11 摄影机不要停！ (2017) {tmdb-513434}

正在匹配库：电影

"双重人格 (2014)" 已被添加到 "小成本大创意" 合集中
"彗星来的那一夜 (2014)" 已被添加到 "小成本大创意" 合集中
"时光穿梭 (2015)" 已被添加到 "小成本大创意" 合集中
"机械姬 (2015)" 已被添加到 "小成本大创意" 合集中
"狗镇 (2003)" 已被添加到 "小成本大创意" 合集中
```
脚本目前支持导入豆瓣、IMDb 和 Trakt 上的片单，请从以上平台的片单地址中获取片单 ID，示例如下：
```
豆瓣片单的 ID 为纯数字，如下方地址的 ID 为 39639105
https://www.douban.com/doulist/39639105/

IMDb 片单的 ID 以 ls 开头，如下方地址的 ID 为 ls527593715
https://www.imdb.com/list/ls527593715/

Trakt 片单的 ID 包含用户名和 ID 两部分，请用空格隔开，如下方地址的 ID 为 callingjupiter best-movies-of-2023
https://trakt.tv/users/callingjupiter/lists/best-movies-of-2023?sort=added,desc
```

## 导入本地片单
当 `collections` 文件夹内包含 `.txt` 格式的片单时，脚本会自动启用**导入本地片单模式**，请运行 `plex-collection-importer.py` 脚本，根据提示进行操作，示例如下：
```
以下是您的Plex服务器上的所有影视库：

1. 电影
2. 动漫
3. 电视剧
4. 综艺

请输入您想选择的库的编号（多个编号请用空格隔开）：1

正在读取片单...

豆瓣电影 Top 250

正在匹配库：电影

"疯狂动物城 (2016)" 已被添加到 "豆瓣电影 Top 250" 合集中
"海上钢琴师 (1998)" 已被添加到 "豆瓣电影 Top 250" 合集中
"美丽人生 (1997)" 已被添加到 "豆瓣电影 Top 250" 合集中
"泰坦尼克号 (1997)" 已被添加到 "豆瓣电影 Top 250" 合集中
"肖申克的救赎 (1994)" 已被添加到 "豆瓣电影 Top 250" 合集中
```
若 `collections` 文件夹内包含多个片单文件，脚本会依次处理每个片单，片单需要按照 `序号 片名 (年份)` 的格式列出影片，也可增加 TMDB、IMDb 或 TVDB 的 ID，并按照 ` {平台-ID}` 的格式添加在行末（当使用片名与年份无法匹配影片时，若存在平台 ID，脚本会使用平台 ID 进行二次匹配，以此解决片单语言与库语言不一致或译名不同产生的匹配问题），示例如下：
```
1 肖申克的救赎 (1994) {tmdb-278}
2 霸王别姬 (1993) {tmdb-10997}
3 阿甘正传 (1994) {imdb-tt0109830}
4 泰坦尼克号 (1997)
5 这个杀手不太冷 (1994) {tvdb-234}
```
片单需要保存为 `.txt` 格式，片单文件名即为生成的合集名称。
